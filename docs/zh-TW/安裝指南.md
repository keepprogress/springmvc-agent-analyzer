# 安裝指南

完整的 SpringMVC Agent Analyzer 安裝說明，涵蓋各種作業系統與環境配置。

## 📋 目錄

- [系統需求](#系統需求)
- [安裝方式](#安裝方式)
  - [方式 1: 標準安裝 (推薦)](#方式-1-標準安裝-推薦)
  - [方式 2: 使用 Poetry](#方式-2-使用-poetry)
  - [方式 3: 使用 Conda](#方式-3-使用-conda)
  - [方式 4: 開發者安裝](#方式-4-開發者安裝)
- [環境設定](#環境設定)
- [驗證安裝](#驗證安裝)
- [故障排除](#故障排除)
- [升級與解除安裝](#升級與解除安裝)

---

## 系統需求

### 必要需求

| 項目 | 最低需求 | 建議配置 | 說明 |
|------|----------|----------|------|
| **作業系統** | Windows 10, macOS 10.15, Ubuntu 20.04 | Windows 11, macOS 13+, Ubuntu 22.04+ | 需要 64 位元系統 |
| **Python** | 3.10 | 3.11 或 3.12 | 不支援 Python 3.9 或更早版本 |
| **記憶體** | 2 GB RAM | 4 GB RAM 以上 | 分析大型專案需要更多記憶體 |
| **磁碟空間** | 500 MB | 1 GB | 包含相依套件 |
| **網路** | 穩定的網路連線 | 寬頻網路 | 需要存取 Anthropic API |

### Python 版本檢查

```bash
# 檢查 Python 版本
python --version

# 或者
python3 --version
```

**預期輸出：**
```
Python 3.10.x
```

**如果版本不符：**

- **Windows**: 前往 [python.org](https://www.python.org/downloads/) 下載最新版本
- **macOS**: 使用 Homebrew 安裝
  ```bash
  brew install python@3.11
  ```
- **Ubuntu/Debian**:
  ```bash
  sudo apt update
  sudo apt install python3.11 python3.11-venv python3.11-dev
  ```

### API 金鑰需求

需要 **Anthropic API 金鑰** 才能使用本系統：

1. **註冊帳號**：前往 [Anthropic Console](https://console.anthropic.com/)
2. **取得 API 金鑰**：在控制台建立新的 API 金鑰
3. **檢查額度**：新用戶通常有 $5 免費額度
4. **付費方案**：依使用量付費，無月費

**成本參考：**
- 小型專案（< 50 檔案）: $2-3
- 中型專案（50-200 檔案）: $4-8
- 大型專案（200-500 檔案）: $10-15

---

## 安裝方式

### 方式 1: 標準安裝 (推薦)

適合大多數使用者，使用 Python 內建的 venv 模組。

#### Step 1: 複製儲存庫

```bash
# 使用 HTTPS
git clone https://github.com/yourusername/springmvc-agent-analyzer.git

# 或使用 SSH (如果已設定 SSH 金鑰)
git clone git@github.com:yourusername/springmvc-agent-analyzer.git

# 進入專案目錄
cd springmvc-agent-analyzer
```

#### Step 2: 建立虛擬環境

**Windows:**
```cmd
# 建立虛擬環境
python -m venv venv

# 啟動虛擬環境
venv\Scripts\activate

# 確認已啟動（命令提示符號應顯示 (venv)）
```

**macOS/Linux:**
```bash
# 建立虛擬環境
python3 -m venv venv

# 啟動虛擬環境
source venv/bin/activate

# 確認已啟動（終端機應顯示 (venv)）
```

**💡 為什麼使用虛擬環境？**
- 隔離專案相依套件
- 避免與系統 Python 套件衝突
- 方便管理不同專案的套件版本

#### Step 3: 升級 pip

```bash
# 升級到最新版 pip
python -m pip install --upgrade pip

# 確認 pip 版本
pip --version
```

**預期輸出：**
```
pip 24.0 from /path/to/venv/lib/python3.11/site-packages/pip (python 3.11)
```

#### Step 4: 安裝相依套件

```bash
# 安裝所有相依套件
pip install -r requirements.txt
```

**安裝過程：**
```
Collecting anthropic==0.x.x
  Downloading anthropic-0.x.x-py3-none-any.whl (150 kB)
Collecting aiofiles==x.x.x
  Downloading aiofiles-x.x.x-py3-none-any.whl (15 kB)
...
Successfully installed anthropic-0.x.x aiofiles-x.x.x ...
```

**安裝時間：** 1-3 分鐘（視網路速度而定）

#### Step 5: 設定環境變數

```bash
# 複製環境變數範本
cp .env.example .env

# 編輯 .env 檔案
# Windows: notepad .env
# macOS: nano .env 或 open -e .env
# Linux: nano .env
```

**在 `.env` 檔案中填入您的設定：**

```bash
# ============================================
# Anthropic API Configuration
# ============================================
ANTHROPIC_API_KEY=sk-ant-api03-your-actual-api-key-here

# ============================================
# Model Configuration
# ============================================
# 預設模型 (用於大多數分析任務)
DEFAULT_MODEL=claude-sonnet-4-20250514

# 備用模型 (用於簡單任務以節省成本)
FALLBACK_MODEL=claude-haiku-3-5-20250514

# ============================================
# Performance Configuration
# ============================================
# 最大並行數 (同時處理幾個檔案)
MAX_CONCURRENCY=5

# 批次大小 (每批次處理幾個檔案)
BATCH_SIZE=10

# ============================================
# Logging Configuration
# ============================================
# 日誌層級: DEBUG, INFO, WARNING, ERROR
LOG_LEVEL=INFO

# 日誌檔案路徑 (留空則只輸出到終端機)
LOG_FILE=logs/sdk_agent.log
```

#### Step 6: 驗證安裝

```bash
# 快速驗證
python -c "from sdk_agent.client import SpringMVCAnalyzerAgent; print('✅ 安裝成功！')"
```

**成功輸出：**
```
✅ 安裝成功！
```

---

### 方式 2: 使用 Poetry

[Poetry](https://python-poetry.org/) 是現代的 Python 相依性管理工具。

#### Step 1: 安裝 Poetry

**Windows (PowerShell):**
```powershell
(Invoke-WebRequest -Uri https://install.python-poetry.org -UseBasicParsing).Content | py -
```

**macOS/Linux:**
```bash
curl -sSL https://install.python-poetry.org | python3 -
```

**確認安裝：**
```bash
poetry --version
```

#### Step 2: 複製並安裝

```bash
# 複製儲存庫
git clone https://github.com/yourusername/springmvc-agent-analyzer.git
cd springmvc-agent-analyzer

# 安裝相依套件（Poetry 會自動建立虛擬環境）
poetry install

# 啟動 Poetry 虛擬環境
poetry shell
```

#### Step 3: 設定環境變數

```bash
# 複製環境變數範本
cp .env.example .env

# 編輯 .env 並填入您的 API 金鑰
```

#### Step 4: 驗證安裝

```bash
# 在 Poetry 環境中執行
poetry run python -c "from sdk_agent.client import SpringMVCAnalyzerAgent; print('✅ 安裝成功！')"
```

**Poetry 的優點：**
- 自動管理虛擬環境
- 更精確的版本鎖定（`poetry.lock`）
- 內建套件發佈功能
- 更好的相依性解析

---

### 方式 3: 使用 Conda

[Conda](https://docs.conda.io/) 是跨平台的套件管理系統。

#### Step 1: 安裝 Conda

下載並安裝 [Miniconda](https://docs.conda.io/en/latest/miniconda.html) 或 [Anaconda](https://www.anaconda.com/)。

#### Step 2: 建立 Conda 環境

```bash
# 建立新環境
conda create -n springmvc-analyzer python=3.11

# 啟動環境
conda activate springmvc-analyzer
```

#### Step 3: 複製並安裝

```bash
# 複製儲存庫
git clone https://github.com/yourusername/springmvc-agent-analyzer.git
cd springmvc-agent-analyzer

# 使用 pip 安裝相依套件（在 Conda 環境中）
pip install -r requirements.txt
```

#### Step 4: 設定環境變數

```bash
cp .env.example .env
# 編輯 .env 填入 API 金鑰
```

#### Step 5: 驗證安裝

```bash
python -c "from sdk_agent.client import SpringMVCAnalyzerAgent; print('✅ 安裝成功！')"
```

**Conda 的優點：**
- 可管理 Python 版本
- 良好的科學計算套件支援
- 跨平台一致性高

---

### 方式 4: 開發者安裝

適合想要貢獻程式碼的開發者。

#### Step 1: Fork 並複製

```bash
# Fork 專案到您的 GitHub 帳號
# 然後複製您的 fork

git clone https://github.com/YOUR_USERNAME/springmvc-agent-analyzer.git
cd springmvc-agent-analyzer

# 新增上游儲存庫
git remote add upstream https://github.com/yourusername/springmvc-agent-analyzer.git
```

#### Step 2: 安裝開發相依套件

```bash
# 建立虛擬環境
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 安裝開發相依套件
pip install -r requirements-dev.txt
```

`requirements-dev.txt` 包含額外的開發工具：
- pytest, pytest-cov (測試)
- black, isort (程式碼格式化)
- flake8, mypy (程式碼檢查)
- pre-commit (Git hooks)

#### Step 3: 設定 Pre-commit Hooks

```bash
# 安裝 pre-commit hooks
pre-commit install

# 測試 hooks
pre-commit run --all-files
```

#### Step 4: 執行測試

```bash
# 執行所有測試
pytest

# 執行特定測試
pytest tests/sdk_agent/

# 執行測試並生成覆蓋率報告
pytest --cov=sdk_agent --cov-report=html
```

#### Step 5: 程式碼格式化

```bash
# 格式化程式碼
black sdk_agent/ tests/

# 排序 import
isort sdk_agent/ tests/

# 程式碼檢查
flake8 sdk_agent/ tests/

# 型別檢查
mypy sdk_agent/
```

---

## 環境設定

### 環境變數詳細說明

#### ANTHROPIC_API_KEY (必填)

您的 Anthropic API 金鑰。

```bash
ANTHROPIC_API_KEY=sk-ant-api03-xxxxx...
```

**取得方式：**
1. 前往 [Anthropic Console](https://console.anthropic.com/)
2. 登入或註冊帳號
3. 點擊 "API Keys" → "Create Key"
4. 複製金鑰並貼到 `.env` 檔案

**⚠️ 安全注意事項：**
- 絕對不要將 API 金鑰提交到 Git
- 不要在程式碼中硬編碼金鑰
- 定期輪換 API 金鑰
- 使用環境變數或密鑰管理服務

#### DEFAULT_MODEL (選填)

預設使用的 Claude 模型。

```bash
DEFAULT_MODEL=claude-sonnet-4-20250514
```

**可用模型：**
- `claude-opus-4-20250514` - 最強大，適合複雜任務
- `claude-sonnet-4-20250514` - **推薦**，平衡效能與成本
- `claude-haiku-3-5-20250514` - 最快速，適合簡單任務

#### FALLBACK_MODEL (選填)

備用模型，用於簡單任務以節省成本。

```bash
FALLBACK_MODEL=claude-haiku-3-5-20250514
```

#### MAX_CONCURRENCY (選填)

同時處理的檔案數量。

```bash
MAX_CONCURRENCY=5  # 預設值
```

**調整建議：**
- **保守**：2-3（避免 API 速率限制）
- **平衡**：5-10（推薦）
- **激進**：15-20（需注意速率限制）

#### BATCH_SIZE (選填)

每批次處理的檔案數量。

```bash
BATCH_SIZE=10  # 預設值
```

**調整建議：**
- 小型專案（< 50 檔案）：10-20
- 中型專案（50-200 檔案）：20-50
- 大型專案（> 200 檔案）：50-100

#### LOG_LEVEL (選填)

日誌詳細程度。

```bash
LOG_LEVEL=INFO  # 預設值
```

**可用層級：**
- `DEBUG` - 最詳細，用於除錯
- `INFO` - 一般資訊（推薦）
- `WARNING` - 僅警告和錯誤
- `ERROR` - 僅錯誤訊息

#### LOG_FILE (選填)

日誌檔案儲存路徑。

```bash
LOG_FILE=logs/sdk_agent.log
```

留空則只輸出到終端機。

### 多環境配置

如果需要在不同環境使用不同設定（開發、測試、生產），可以建立多個環境檔案：

```bash
.env.development  # 開發環境
.env.testing      # 測試環境
.env.production   # 生產環境
```

**使用特定環境：**

```python
from dotenv import load_dotenv

# 載入特定環境檔案
load_dotenv('.env.production')
```

---

## 驗證安裝

### 基本驗證

```bash
# 驗證 Python 套件
python -c "import sdk_agent; print(sdk_agent.__version__)"
```

### 完整驗證腳本

建立 `verify_installation.py`：

```python
"""驗證 SpringMVC Agent Analyzer 安裝"""
import sys
import os
from pathlib import Path

def check_python_version():
    """檢查 Python 版本"""
    version = sys.version_info
    if version.major >= 3 and version.minor >= 10:
        print(f"✅ Python 版本: {version.major}.{version.minor}.{version.micro}")
        return True
    else:
        print(f"❌ Python 版本過舊: {version.major}.{version.minor}.{version.micro}")
        print("   需要 Python 3.10 或更高版本")
        return False

def check_dependencies():
    """檢查相依套件"""
    required_packages = [
        "anthropic",
        "aiofiles",
        "python-dotenv",
        "pydantic"
    ]

    all_ok = True
    for package in required_packages:
        try:
            __import__(package.replace("-", "_"))
            print(f"✅ {package} 已安裝")
        except ImportError:
            print(f"❌ {package} 未安裝")
            all_ok = False

    return all_ok

def check_env_file():
    """檢查環境變數檔案"""
    env_path = Path(".env")
    if not env_path.exists():
        print("❌ .env 檔案不存在")
        print("   請執行: cp .env.example .env")
        return False

    print("✅ .env 檔案存在")

    # 檢查 API 金鑰
    from dotenv import load_dotenv
    load_dotenv()

    api_key = os.getenv("ANTHROPIC_API_KEY")
    if not api_key:
        print("⚠️  ANTHROPIC_API_KEY 未設定")
        return False
    elif api_key.startswith("sk-ant-api03-your-"):
        print("⚠️  請在 .env 中設定您的實際 API 金鑰")
        return False
    else:
        print("✅ ANTHROPIC_API_KEY 已設定")
        return True

def check_sdk_agent():
    """檢查 SDK Agent 模組"""
    try:
        from sdk_agent.client import SpringMVCAnalyzerAgent
        print("✅ SDK Agent 模組可正常匯入")
        return True
    except Exception as e:
        print(f"❌ SDK Agent 模組匯入失敗: {e}")
        return False

def main():
    """執行所有驗證"""
    print("=" * 60)
    print("SpringMVC Agent Analyzer - 安裝驗證")
    print("=" * 60)
    print()

    results = []

    print("1. 檢查 Python 版本...")
    results.append(check_python_version())
    print()

    print("2. 檢查相依套件...")
    results.append(check_dependencies())
    print()

    print("3. 檢查環境變數...")
    results.append(check_env_file())
    print()

    print("4. 檢查 SDK Agent 模組...")
    results.append(check_sdk_agent())
    print()

    print("=" * 60)
    if all(results):
        print("✅ 所有檢查通過！安裝成功！")
        print()
        print("下一步:")
        print("  - 閱讀快速開始: docs/zh-TW/快速開始.md")
        print("  - 執行第一個範例: python examples/example_basic.py")
        return 0
    else:
        print("❌ 部分檢查失敗，請參考上方訊息進行修正")
        print()
        print("需要幫助？")
        print("  - 故障排除: docs/zh-TW/故障排除.md")
        print("  - GitHub Issues: https://github.com/yourusername/springmvc-agent-analyzer/issues")
        return 1

if __name__ == "__main__":
    sys.exit(main())
```

**執行驗證：**

```bash
python verify_installation.py
```

**預期輸出：**

```
============================================================
SpringMVC Agent Analyzer - 安裝驗證
============================================================

1. 檢查 Python 版本...
✅ Python 版本: 3.11.5

2. 檢查相依套件...
✅ anthropic 已安裝
✅ aiofiles 已安裝
✅ python-dotenv 已安裝
✅ pydantic 已安裝

3. 檢查環境變數...
✅ .env 檔案存在
✅ ANTHROPIC_API_KEY 已設定

4. 檢查 SDK Agent 模組...
✅ SDK Agent 模組可正常匯入

============================================================
✅ 所有檢查通過！安裝成功！

下一步:
  - 閱讀快速開始: docs/zh-TW/快速開始.md
  - 執行第一個範例: python examples/example_basic.py
```

---

## 故障排除

### 問題 1: Python 版本不符

**錯誤訊息：**
```
ERROR: This package requires Python 3.10+
```

**解決方案：**

1. **確認目前版本：**
   ```bash
   python --version
   ```

2. **安裝正確版本：**
   - **Windows**: 從 [python.org](https://www.python.org/downloads/) 下載安裝程式
   - **macOS**: `brew install python@3.11`
   - **Ubuntu**: `sudo apt install python3.11`

3. **使用特定版本建立虛擬環境：**
   ```bash
   python3.11 -m venv venv
   ```

### 問題 2: pip 安裝失敗

**錯誤訊息：**
```
ERROR: Could not install packages due to an OSError
```

**解決方案：**

1. **升級 pip：**
   ```bash
   python -m pip install --upgrade pip
   ```

2. **使用 --user 標記：**
   ```bash
   pip install --user -r requirements.txt
   ```

3. **檢查權限：**
   - Windows: 以系統管理員身分執行
   - macOS/Linux: 使用 `sudo` 或虛擬環境

4. **清除 pip 快取：**
   ```bash
   pip cache purge
   pip install -r requirements.txt
   ```

### 問題 3: 模組找不到

**錯誤訊息：**
```
ModuleNotFoundError: No module named 'sdk_agent'
```

**解決方案：**

1. **確認虛擬環境已啟動：**
   - 命令提示符號應顯示 `(venv)`
   - 如果沒有，執行啟動指令

2. **確認在正確目錄：**
   ```bash
   pwd  # 或 cd (Windows)
   # 應該在 springmvc-agent-analyzer 目錄下
   ```

3. **重新安裝套件：**
   ```bash
   pip install -r requirements.txt
   ```

4. **檢查 Python 路徑：**
   ```python
   import sys
   print(sys.path)
   ```

### 問題 4: API 金鑰錯誤

**錯誤訊息：**
```
AuthenticationError: Invalid API key
```

**解決方案：**

1. **確認 .env 檔案存在：**
   ```bash
   ls -la .env  # macOS/Linux
   dir .env     # Windows
   ```

2. **檢查 API 金鑰格式：**
   - 應以 `sk-ant-api03-` 開頭
   - 沒有多餘的空格或引號
   - 完整複製整個金鑰

3. **測試 API 金鑰：**
   ```python
   import os
   from dotenv import load_dotenv

   load_dotenv()
   api_key = os.getenv("ANTHROPIC_API_KEY")
   print(f"API Key (前 20 字元): {api_key[:20]}")
   ```

4. **重新產生金鑰：**
   - 前往 [Anthropic Console](https://console.anthropic.com/)
   - 建立新的 API 金鑰
   - 更新 `.env` 檔案

### 問題 5: 網路連線問題

**錯誤訊息：**
```
ConnectionError: Failed to connect to api.anthropic.com
```

**解決方案：**

1. **檢查網路連線：**
   ```bash
   ping api.anthropic.com
   ```

2. **檢查防火牆設定：**
   - 確認允許 Python 存取網路
   - 檢查公司防火牆規則

3. **使用代理伺服器：**
   ```bash
   # 在 .env 中設定代理
   HTTP_PROXY=http://proxy.example.com:8080
   HTTPS_PROXY=http://proxy.example.com:8080
   ```

4. **測試 API 連線：**
   ```python
   import anthropic
   client = anthropic.Anthropic()
   # 如果沒有錯誤，連線正常
   ```

### 問題 6: Git 複製失敗

**錯誤訊息：**
```
fatal: unable to access 'https://github.com/...': Failed to connect
```

**解決方案：**

1. **檢查 Git 安裝：**
   ```bash
   git --version
   ```

2. **使用 HTTPS 而非 SSH：**
   ```bash
   git clone https://github.com/yourusername/springmvc-agent-analyzer.git
   ```

3. **下載 ZIP 檔案：**
   - 前往 GitHub 專案頁面
   - 點擊 "Code" → "Download ZIP"
   - 解壓縮到目標目錄

---

## 升級與解除安裝

### 升級到最新版本

```bash
# 進入專案目錄
cd springmvc-agent-analyzer

# 拉取最新程式碼
git pull origin main

# 啟動虛擬環境
source venv/bin/activate  # Windows: venv\Scripts\activate

# 升級相依套件
pip install --upgrade -r requirements.txt
```

### 檢查版本

```python
# 檢查已安裝版本
import sdk_agent
print(sdk_agent.__version__)

# 檢查最新版本
# 前往 GitHub Releases 查看
```

### 解除安裝

```bash
# 1. 停用虛擬環境
deactivate

# 2. 刪除專案目錄
cd ..
rm -rf springmvc-agent-analyzer  # macOS/Linux
# Windows: rmdir /s springmvc-agent-analyzer

# 3. (可選) 移除 Conda 環境
conda env remove -n springmvc-analyzer
```

---

## 下一步

✅ **安裝完成！** 現在您可以：

1. **📖 閱讀快速開始**
   - [30 分鐘入門教學](./快速開始.md)
   - 執行第一個分析範例

2. **📚 深入學習**
   - [使用手冊](./使用手冊.md) - 完整功能說明
   - [SDK 代理模式](./SDK代理模式指南.md) - 進階用法

3. **🎯 實際應用**
   - 分析您的 SpringMVC 專案
   - 建立知識圖譜
   - 產生文件

4. **🆘 需要幫助**
   - [常見問題 FAQ](./常見問題.md)
   - [故障排除](./故障排除.md)
   - [GitHub Issues](https://github.com/yourusername/springmvc-agent-analyzer/issues)

---

**上一篇：** [← README](./README.md)
**下一篇：** [快速開始 →](./快速開始.md)
