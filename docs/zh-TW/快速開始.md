# 快速開始 - 30 分鐘入門教學

歡迎使用 **SpringMVC Agent Analyzer**！本指南將帶您在 30 分鐘內完成安裝並執行第一個分析。

## 📋 前置需求

在開始之前，請確認您的環境符合以下條件：

### 必要條件

- **Python 3.10 或更高版本**
  ```bash
  python --version  # 應顯示 Python 3.10.x 或更高
  ```

- **Anthropic API 金鑰**
  - 前往 [Anthropic Console](https://console.anthropic.com/) 註冊並取得 API 金鑰
  - 新用戶通常有 $5 的免費額度
  - 每次分析成本約 $4-5（相比傳統方案的 $40 節省 89%）

- **Git**（用於複製儲存庫）
  ```bash
  git --version
  ```

### 可選但建議

- **虛擬環境管理工具**（venv、conda、poetry）
- **程式碼編輯器**（VS Code、PyCharm、Sublime Text）
- **待分析的 SpringMVC 專案**（用於實際測試）

---

## 🚀 五步驟安裝

### 步驟 1：複製儲存庫

```bash
# 複製專案
git clone https://github.com/yourusername/springmvc-agent-analyzer.git

# 進入專案目錄
cd springmvc-agent-analyzer
```

**預期輸出：**
```
Cloning into 'springmvc-agent-analyzer'...
remote: Enumerating objects: 1234, done.
remote: Counting objects: 100% (1234/1234), done.
```

### 步驟 2：建立虛擬環境（建議）

```bash
# 使用 Python venv
python -m venv venv

# 啟動虛擬環境
# Windows:
venv\Scripts\activate
# macOS/Linux:
source venv/bin/activate
```

**預期輸出：**
您的命令提示符號前方應出現 `(venv)` 字樣。

### 步驟 3：安裝相依套件

```bash
# 升級 pip
python -m pip install --upgrade pip

# 安裝所有相依套件
pip install -r requirements.txt
```

**預期輸出：**
```
Successfully installed anthropic-0.x.x aiofiles-x.x.x ...
```

**安裝時間：** 約 1-2 分鐘（取決於網路速度）

### 步驟 4：設定 API 金鑰

```bash
# 複製環境變數範例檔案
cp .env.example .env

# 編輯 .env 檔案（使用任何文字編輯器）
# Windows:
notepad .env
# macOS/Linux:
nano .env
```

**在 `.env` 檔案中設定您的 API 金鑰：**

```bash
# Anthropic API Configuration
ANTHROPIC_API_KEY=sk-ant-api03-your-actual-api-key-here

# Model Configuration (可選)
DEFAULT_MODEL=claude-sonnet-4-20250514
FALLBACK_MODEL=claude-haiku-3-5-20250514

# Performance Configuration (可選)
MAX_CONCURRENCY=5
BATCH_SIZE=10
```

**⚠️ 安全提示：**
- 絕對不要將 `.env` 檔案提交到 Git
- `.gitignore` 已預設排除 `.env` 檔案
- 不要在程式碼中直接寫入 API 金鑰

### 步驟 5：驗證安裝

```bash
# 執行快速測試
python -c "from sdk_agent.client import SpringMVCAnalyzerAgent; print('✅ 安裝成功！')"
```

**預期輸出：**
```
✅ 安裝成功！
```

**如果出現錯誤：**
- `ModuleNotFoundError`: 重新執行步驟 3 安裝相依套件
- `ImportError`: 檢查 Python 版本是否 >= 3.10
- 其他錯誤：參閱 [故障排除指南](./故障排除.md)

---

## 🎯 第一個範例：分析 Controller 檔案

現在讓我們執行第一個實際分析！

### 範例 1：分析單一 Controller

建立一個新檔案 `example_basic.py`：

```python
"""
基本範例：分析單一 SpringMVC Controller 檔案
"""
import asyncio
from pathlib import Path
from sdk_agent.client import SpringMVCAnalyzerAgent

async def main():
    # 1. 初始化智能體
    agent = SpringMVCAnalyzerAgent()

    # 2. 指定要分析的 Controller 檔案路徑
    controller_path = Path("examples/sample_project/UserController.java")

    # 3. 執行分析
    print(f"🔍 正在分析: {controller_path}")
    result = await agent.analyze_file(
        file_path=str(controller_path),
        file_type="controller"
    )

    # 4. 顯示結果
    print("\n📊 分析結果:")
    print(f"- 檔案類型: {result['file_type']}")
    print(f"- 分析狀態: {result['status']}")
    print(f"- 處理時間: {result['processing_time']:.2f}秒")

    # 5. 顯示發現的路由
    if 'routes' in result:
        print(f"\n🛣️ 發現 {len(result['routes'])} 個路由:")
        for route in result['routes']:
            print(f"  - {route['method']:6s} {route['path']}")

    # 6. 顯示相依性
    if 'dependencies' in result:
        print(f"\n🔗 相依性 ({len(result['dependencies'])} 個):")
        for dep in result['dependencies']:
            print(f"  - {dep['type']}: {dep['name']}")

# 執行主程式
if __name__ == "__main__":
    asyncio.run(main())
```

### 執行範例

```bash
python example_basic.py
```

### 預期輸出

```
🔍 正在分析: examples/sample_project/UserController.java

📊 分析結果:
- 檔案類型: controller
- 分析狀態: success
- 處理時間: 1.23秒

🛣️ 發現 5 個路由:
  - GET    /users
  - GET    /users/{id}
  - POST   /users
  - PUT    /users/{id}
  - DELETE /users/{id}

🔗 相依性 (2 個):
  - service: UserService
  - repository: UserRepository
```

### 輸出說明

讓我們逐項解釋輸出結果：

1. **file_type: controller**
   - 確認檔案被正確識別為 SpringMVC Controller

2. **status: success**
   - 分析成功完成
   - 其他可能值：`error`（失敗）、`partial`（部分成功）

3. **processing_time: 1.23秒**
   - LLM 分析耗時
   - 通常在 0.5-2 秒之間（取決於檔案複雜度）

4. **routes（路由）**
   - 自動提取所有 `@RequestMapping`、`@GetMapping` 等註解
   - 包含 HTTP 方法（GET/POST/PUT/DELETE）和路徑

5. **dependencies（相依性）**
   - 自動識別 `@Autowired`、`@Resource` 注入的服務
   - 包括 Service、Repository、Component 等

---

## 🎓 範例 2：批次分析多個檔案

現在讓我們分析整個專案！建立 `example_batch.py`：

```python
"""
批次範例：分析整個 SpringMVC 專案
"""
import asyncio
from pathlib import Path
from sdk_agent.client import SpringMVCAnalyzerAgent

async def main():
    # 1. 初始化智能體
    agent = SpringMVCAnalyzerAgent(
        max_concurrency=5,  # 同時處理 5 個檔案
        batch_size=10       # 每批次 10 個檔案
    )

    # 2. 收集所有 Java 檔案
    project_root = Path("examples/sample_project")
    java_files = list(project_root.rglob("*.java"))

    print(f"📁 找到 {len(java_files)} 個 Java 檔案")

    # 3. 批次分析
    results = await agent.analyze_batch(
        file_paths=[str(f) for f in java_files],
        show_progress=True  # 顯示進度條
    )

    # 4. 統計結果
    successful = sum(1 for r in results if r['status'] == 'success')
    failed = len(results) - successful

    print(f"\n✅ 成功: {successful}/{len(results)}")
    print(f"❌ 失敗: {failed}/{len(results)}")

    # 5. 按類型分組
    by_type = {}
    for result in results:
        file_type = result.get('file_type', 'unknown')
        by_type[file_type] = by_type.get(file_type, 0) + 1

    print("\n📊 檔案類型分布:")
    for file_type, count in sorted(by_type.items()):
        print(f"  - {file_type:15s}: {count:3d} 個")

    # 6. 計算總成本
    total_cost = sum(r.get('cost', 0) for r in results)
    print(f"\n💰 總成本: ${total_cost:.4f}")

if __name__ == "__main__":
    asyncio.run(main())
```

### 執行批次分析

```bash
python example_batch.py
```

### 預期輸出

```
📁 找到 45 個 Java 檔案

Processing files: 100%|██████████████████| 45/45 [00:08<00:00,  5.23 files/s]

✅ 成功: 43/45
❌ 失敗: 2/45

📊 檔案類型分布:
  - controller   :  12 個
  - service      :  15 個
  - repository   :   8 個
  - entity       :  10 個

💰 總成本: $4.23
```

---

## 🔍 範例 3：分析 JSP 視圖

SpringMVC Agent Analyzer 也能分析 JSP 檔案！建立 `example_jsp.py`：

```python
"""
JSP 範例：分析 JSP 視圖檔案
"""
import asyncio
from pathlib import Path
from sdk_agent.client import SpringMVCAnalyzerAgent

async def main():
    agent = SpringMVCAnalyzerAgent()

    # 分析 JSP 檔案
    jsp_path = Path("examples/sample_project/webapp/user-list.jsp")
    result = await agent.analyze_file(
        file_path=str(jsp_path),
        file_type="jsp"
    )

    print(f"🎨 JSP 分析結果: {jsp_path.name}")

    # 顯示 includes
    if 'includes' in result:
        print(f"\n📄 Include 檔案 ({len(result['includes'])} 個):")
        for inc in result['includes']:
            print(f"  - {inc}")

    # 顯示 AJAX 呼叫
    if 'ajax_calls' in result:
        print(f"\n🌐 AJAX 呼叫 ({len(result['ajax_calls'])} 個):")
        for ajax in result['ajax_calls']:
            print(f"  - {ajax['method']:4s} {ajax['url']}")

    # 顯示表單提交
    if 'forms' in result:
        print(f"\n📝 表單 ({len(result['forms'])} 個):")
        for form in result['forms']:
            print(f"  - action: {form['action']}, method: {form['method']}")

if __name__ == "__main__":
    asyncio.run(main())
```

### 預期輸出

```
🎨 JSP 分析結果: user-list.jsp

📄 Include 檔案 (3 個):
  - /WEB-INF/views/common/header.jsp
  - /WEB-INF/views/common/navigation.jsp
  - /WEB-INF/views/common/footer.jsp

🌐 AJAX 呼叫 (2 個):
  - GET  /api/users
  - POST /api/users/search

📝 表單 (1 個):
  - action: /users/create, method: POST
```

---

## 📊 理解成本

了解 API 使用成本非常重要：

### 成本計算

```python
"""
成本範例：了解 API 使用成本
"""
import asyncio
from sdk_agent.client import SpringMVCAnalyzerAgent

async def main():
    agent = SpringMVCAnalyzerAgent()

    # 分析前先預估成本
    files = ["Controller.java", "Service.java", "Mapper.xml"]
    estimated_cost = agent.estimate_cost(
        file_count=len(files),
        avg_file_size=5000  # 平均 5KB
    )

    print(f"💰 預估成本: ${estimated_cost:.4f}")
    print(f"   ({len(files)} 個檔案)")

    # 執行分析
    results = await agent.analyze_batch(
        file_paths=[f"examples/{f}" for f in files]
    )

    # 顯示實際成本
    actual_cost = sum(r.get('cost', 0) for r in results)
    print(f"\n💵 實際成本: ${actual_cost:.4f}")
    print(f"   誤差: {abs(estimated_cost - actual_cost):.4f}")

if __name__ == "__main__":
    asyncio.run(main())
```

### 成本參考

| 模型 | 輸入成本 | 輸出成本 | 適用場景 |
|------|----------|----------|----------|
| **Claude Haiku** | $0.25/MTok | $1.25/MTok | 簡單分析 |
| **Claude Sonnet** | $3.00/MTok | $15.00/MTok | 複雜分析 |
| **Claude Opus** | $15.00/MTok | $75.00/MTok | 關鍵任務 |

**平均成本（中型專案）：**
- 每個檔案: $0.08 - $0.12
- 50 個檔案: $4.00 - $6.00
- 100 個檔案: $8.00 - $12.00

**💡 省錢技巧：**
1. 使用語義快取（自動，60-80% 命中率）
2. 批次處理而非單檔處理
3. 調整 `max_concurrency` 和 `batch_size`
4. 使用 Haiku 模型處理簡單檔案

---

## ⚠️ 常見問題處理

### 問題 1：API 金鑰錯誤

**錯誤訊息：**
```
AuthenticationError: Invalid API key
```

**解決方案：**
1. 確認 `.env` 檔案存在且格式正確
2. 檢查 API 金鑰沒有多餘的空格或引號
3. 確認金鑰以 `sk-ant-api03-` 開頭
4. 在 [Anthropic Console](https://console.anthropic.com/) 確認金鑰有效

### 問題 2：檔案找不到

**錯誤訊息：**
```
[FileNotFoundError] file_operation: Failed to read file
```

**解決方案：**
1. 確認檔案路徑正確（使用絕對路徑或相對於專案根目錄）
2. 檢查檔案是否存在：`ls examples/sample_project/`
3. 確認檔案權限可讀

### 問題 3：速度太慢

**症狀：**
批次處理 100 個檔案需要超過 5 分鐘

**解決方案：**
```python
# 調整並行參數
agent = SpringMVCAnalyzerAgent(
    max_concurrency=10,  # 增加到 10（預設 5）
    batch_size=20        # 增加到 20（預設 10）
)
```

**⚠️ 注意：**
- 太高的並行數可能觸發 API 速率限制
- 建議從 5 開始，逐步調整到 10-15

### 問題 4：記憶體不足

**症狀：**
```
MemoryError: Unable to allocate memory
```

**解決方案：**
```python
# 降低批次大小和並行數
agent = SpringMVCAnalyzerAgent(
    max_concurrency=2,   # 降低並行數
    batch_size=5         # 降低批次大小
)
```

---

## 🎓 下一步學習

恭喜！您已經完成 30 分鐘快速入門。現在您可以：

### 立即行動

1. **分析您的專案**
   - 將範例程式碼套用到您的 SpringMVC 專案
   - 從小範圍開始（5-10 個檔案）
   - 逐步擴展到整個專案

2. **探索進階功能**
   - [SDK 代理模式指南](./SDK代理模式指南.md) - 深入了解雙向對話模式
   - [錯誤處理指南](./錯誤處理指南.md) - 學習最佳實踐
   - [使用手冊](./使用手冊.md) - 完整功能參考

3. **最佳化工作流程**
   - [最佳實踐](./最佳實踐.md) - 效能調校與成本最佳化
   - [API 參考](./API參考.md) - 完整 API 文檔

### 學習路徑建議

**初學者（第 1-3 天）：**
- ✅ 完成本快速入門
- 📖 閱讀[使用手冊](./使用手冊.md) 第 1-2 章
- 🚀 分析您的第一個小型專案（10-20 個檔案）

**進階使用者（第 4-7 天）：**
- 📚 學習 [SDK 代理模式](./SDK代理模式指南.md)
- 🛠️ 掌握[錯誤處理](./錯誤處理指南.md)
- ⚡ 最佳化效能與成本

**開發者（第 8-14 天）：**
- 🏗️ 研究[架構說明](./架構說明.md)
- 🔧 客製化智能體行為
- 🤝 貢獻到開源社群

---

## 🆘 需要幫助？

### 文檔資源

- 📖 [完整文檔索引](./README.md)
- ❓ [常見問題 FAQ](./常見問題.md)
- 🔧 [故障排除指南](./故障排除.md)
- 📚 [術語表](./術語表.md)

### 社群支援

- 💬 [GitHub Discussions](https://github.com/yourusername/springmvc-agent-analyzer/discussions) - 提問與討論
- 🐛 [GitHub Issues](https://github.com/yourusername/springmvc-agent-analyzer/issues) - 回報問題
- 📧 Email: your.email@example.com

### 快速連結

| 需求 | 前往 |
|------|------|
| 我想深入了解所有功能 | [使用手冊](./使用手冊.md) |
| 我遇到錯誤需要解決 | [故障排除](./故障排除.md) |
| 我想最佳化效能 | [最佳實踐](./最佳實踐.md) |
| 我想了解系統架構 | [架構說明](./架構說明.md) |
| 我想使用雙向對話模式 | [SDK代理模式指南](./SDK代理模式指南.md) |

---

## 📝 總結

在這 30 分鐘的教學中，您學會了：

✅ **安裝與設定**
- 安裝 Python 套件
- 設定 Anthropic API 金鑰
- 驗證環境

✅ **基本分析**
- 分析單一 Controller 檔案
- 理解分析結果
- 提取路由與相依性

✅ **批次處理**
- 同時分析多個檔案
- 使用進度條
- 統計分析結果

✅ **多檔案類型**
- 分析 JSP 視圖
- 提取 AJAX 呼叫
- 追蹤表單提交

✅ **成本管理**
- 預估分析成本
- 選擇適當模型
- 最佳化 API 使用

**🎉 恭喜！您現在可以開始分析您自己的 SpringMVC 專案了！**

---

**下一篇：** [使用手冊 - 完整功能指南](./使用手冊.md) →
